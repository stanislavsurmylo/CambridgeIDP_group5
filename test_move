from machine import Pin, PWM
from time import sleep

SENSOR_PIN = 12          # GP16 -> D0 (through level shifting / divider)
LED_PIN = 28          # On-board LED

# === SETUP ===
sensor = Pin(SENSOR_PIN, Pin.IN)
led = Pin(LED_PIN, Pin.OUT)

last_state = None

class Motor:
    def __init__(self, dirPin, PWMPin):
        self.mDir = Pin(dirPin, Pin.OUT)  # set motor direction pin
        self.pwm = PWM(Pin(PWMPin))  # set motor pwm pin
        self.pwm.freq(1000)  # set PWM frequency
        self.pwm.duty_u16(0)  # set duty cycle - 0=off
        
    def off(self):
        self.pwm.duty_u16(0)
        
    def Forward(self, speed=100):
        self.mDir.value(0)                     # forward = 0 reverse = 1 motor
        self.pwm.duty_u16(int(65535 * speed / 100))  # speed range 0-100 motor
    def Reverse(self, speed=30):
        self.mDir.value(1)
        self.pwm.duty_u16(int(65535 * speed / 100))

def test_move():
    motor1 = Motor(dirPin=4, PWMPin=5)  # Motor 3 is controlled from Motor Driv2 #1, which is on GP4/5
    motor2 = Motor(dirPin=6, PWMPin=7)  # Motor 4 is controlled from Motor Driv2 #2, which is on GP6/7

    while True:
        clr = sensor.value()           # 0 for black or 1 for white

        # Light LED when black line is detected
        led.value(clr)

        # Print only on change to keep output tidy
        if clr != last_state:
            if clr == 0:
                print("black")

            else:
                print("white")
                motor1.Forward()
                motor2.Forward()
            last_state = clr
        # Motor 3 is controlled from Motor Driv2 #1, which is on GP4/5




if __name__ == "__main__":
    test_move()